// Navegación entre secciones
function showSection(sectionId) {
    // Ocultar todas las secciones
    document.querySelectorAll('.content-section').forEach(section => {
        section.classList.remove('active');
    });
    
    // Mostrar la sección seleccionada
    document.getElementById(sectionId).classList.add('active');
    
    // Actualizar estado activo en sidebar
    document.querySelectorAll('.sidebar-item').forEach(item => {
        item.classList.remove('active');
    });
    
    // Encontrar el botón correspondiente en el sidebar
    const activeButton = Array.from(document.querySelectorAll('.sidebar-item')).find(button => {
        return button.getAttribute('onclick')?.includes(sectionId);
    });
    
    if (activeButton) {
        activeButton.classList.add('active');
    }
}

// Manejo de carga de archivos
document.addEventListener('DOMContentLoaded', function() {
    const fileInput = document.getElementById('ticket-attachments');
    const fileList = document.getElementById('file-list');
    
    if (fileInput && fileList) {
        fileInput.addEventListener('change', function() {
            fileList.innerHTML = '';
            
            if (this.files.length > 0) {
                const list = document.createElement('ul');
                list.className = 'file-list-items';
                
                Array.from(this.files).forEach((file, index) => {
                    const listItem = document.createElement('li');
                    listItem.className = 'file-list-item';
                    
                    const fileName = document.createElement('span');
                    fileName.textContent = file.name;
                    fileName.className = 'file-name';
                    
                    const fileSize = document.createElement('span');
                    fileSize.textContent = formatFileSize(file.size);
                    fileSize.className = 'file-size';
                    
                    const removeBtn = document.createElement('button');
                    removeBtn.innerHTML = '<i class="fas fa-times"></i>';
                    removeBtn.className = 'remove-file-btn';
                    removeBtn.onclick = function() {
                        removeFile(index);
                    };
                    
                    listItem.appendChild(fileName);
                    listItem.appendChild(fileSize);
                    listItem.appendChild(removeBtn);
                    list.appendChild(listItem);
                });
                
                fileList.appendChild(list);
            }
        });
    }
    
    // Simulación de usuario actual
    const currentUser = localStorage.getItem('currentUser') || 'Juan Pérez (Empleado)';
    const userElement = document.getElementById('current-user');
    if (userElement) {
        userElement.textContent = currentUser;
    }
    
    // Manejo del formulario de ticket
    const ticketForm = document.getElementById('ticketForm');
    if (ticketForm) {
        ticketForm.addEventListener('submit', function(e) {
            e.preventDefault();
            alert('¡Ticket enviado con éxito! En una implementación real, esto enviaría los datos al servidor.');
            // Aquí iría la lógica para enviar el formulario
        });
    }
});

function formatFileSize(bytes) {
    if (bytes === 0) return '0 Bytes';
    const k = 1024;
    const sizes = ['Bytes', 'KB', 'MB', 'GB'];
    const i = Math.floor(Math.log(bytes) / Math.log(k));
    return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
}

function removeFile(index) {
    const fileInput = document.getElementById('ticket-attachments');
    const dt = new DataTransfer();
    
    // Agregar todos los archivos excepto el que queremos eliminar
    Array.from(fileInput.files).forEach((file, i) => {
        if (i !== index) {
            dt.items.add(file);
        }
    });
    
    fileInput.files = dt.files;
    
    // Disparar evento change para actualizar la lista
    const event = new Event('change');
    fileInput.dispatchEvent(event);
}

// Cambiar rol de usuario (para demo)
function changeUserRole(role) {
    const roles = {
        'empleado': 'Juan Pérez (Empleado)',
        'tecnico': 'Carlos Rodríguez (Técnico)',
        'admin': 'Ana García (Administradora)'
    };
    
    const userName = roles[role] || 'Usuario Desconocido';
    localStorage.setItem('currentUser', userName);
    
    const userElement = document.getElementById('current-user');
    if (userElement) {
        userElement.textContent = userName;
    }
    
    alert(`Rol cambiado a: ${userName}`);
}